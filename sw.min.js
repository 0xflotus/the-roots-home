"use strict";var CACHE_NAME='1593796016';var urlsToCache=['/?utm_source=homescreen'];var idbDatabase;var IDB_VERSION=1593796016;var STOP_RETRYING_AFTER=86400000;var STORE_NAME='urls';function openDatabaseAndReplayRequests(){var indexedDBOpenRequest=indexedDB.open('offline-analytics',IDB_VERSION);indexedDBOpenRequest.onerror=function(error){console.error('IndexedDB error:',error);};indexedDBOpenRequest.onupgradeneeded=function(){this.result.createObjectStore(STORE_NAME,{keyPath:'url'});};indexedDBOpenRequest.onsuccess=function(){idbDatabase=this.result;replayAnalyticsRequests();};}
function getObjectStore(storeName,mode){return idbDatabase.transaction(storeName,mode).objectStore(storeName);}
function replayAnalyticsRequests(){var savedRequests=[];getObjectStore(STORE_NAME).openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){savedRequests.push(cursor.value);cursor.continue();}else{savedRequests.forEach(function(savedRequest){var queueTime=Date.now()-savedRequest.timestamp;if(queueTime>STOP_RETRYING_AFTER){getObjectStore(STORE_NAME,'readwrite').delete(savedRequest.url);}else{var requestUrl=savedRequest.url+'&qt='+queueTime;fetch(requestUrl).then(function(response){if(response.status<400){getObjectStore(STORE_NAME,'readwrite').delete(savedRequest.url);}else{}}).catch(function(error){});}});}};}
openDatabaseAndReplayRequests();self.addEventListener('install',event=>{event.waitUntil(caches.open(CACHE_NAME).then(cache=>cache.addAll(urlsToCache)).then(()=>{return self.skipWaiting();}));});self.addEventListener('fetch',event=>{event.respondWith(caches.match(event.request).then(response=>{if(response)return response;var fetchRequest=event.request.clone();return fetch(fetchRequest).then(response=>{if(!response||response.status!=200||response.type!=='basic'){if(response.status>=500){checkForAnalyticsRequest(event.request.url);}
return response;}
var responseToCache=response.clone();caches.open(CACHE_NAME).then(cache=>{cache.put(event.request,responseToCache);});return response;}).catch(()=>{checkForAnalyticsRequest(event.request.url);return caches.match('/offline.html');})}));});self.addEventListener('activate',event=>{var chacheWhiteList=[CACHE_NAME];event.waitUntil(caches.keys().then(keyList=>{return Promise.all(keyList.map(key=>{if(chacheWhiteList.indexOf(key)===-1)
return caches.delete(key);}));}).then(()=>{return self.clients.claim();}));});function checkForAnalyticsRequest(requestUrl){var url=new URL(requestUrl);if((url.hostname==='www.google-analytics.com'||url.hostname==='ssl.google-analytics.com')&&url.pathname==='/collect'){saveAnalyticsRequest(requestUrl);}}
function saveAnalyticsRequest(requestUrl){getObjectStore(STORE_NAME,'readwrite').add({url:requestUrl,timestamp:Date.now()});}